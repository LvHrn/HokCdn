function initPostPage(){initPost(),initPostMenu()}function initComments(){changeCommentPattern(),activeCommentDraw(),rewriteComments(),activeCommentSubmit(),setCommentReplyTarget(),formatCommentsPageHash(),initOwo()}function changeCommentPattern(){$(".hok_comment").length&&$(".hok_comment__respond-type .item").on("click",function(){$(this).addClass("active").siblings().removeClass("active"),"draw"===$(this).attr("data-type")?($(".hok_comment__respond-form .body .draw").show().siblings().hide(),$("#hok_comment_draw").prop("width",$(".hok_comment__respond-form .body").width()),$(".hok_comment__respond-form").attr("data-type","draw")):($(".hok_comment__respond-form .body .text").show().siblings().hide(),$(".hok_comment__respond-form").attr("data-type","text"))})}function activeCommentDraw(){$("#hok_comment_draw").length&&(window.sketchpad=new Sketchpad({element:"#hok_comment_draw",height:300,penSize:5,color:"303133"}),$(".hok_comment__respond-form .body .draw .icon-undo").on("click",()=>window.sketchpad.undo()),$(".hok_comment__respond-form .body .draw .icon-animate").on("click",()=>window.sketchpad.animate(10)),$(".hok_comment__respond-form .body .draw .line li").on("click",function(){window.sketchpad.penSize=$(this).attr("data-line"),$(this).addClass("active").siblings().removeClass("active")}),$(".hok_comment__respond-form .body .draw .color li").on("click",function(){window.sketchpad.color=$(this).attr("data-color"),$(this).addClass("active").siblings().removeClass("active")}))}function rewriteComments(){if($(".hok_comment__respond").length){const t=$(".hok_comment__respond");$(".hok_comment__reply").on("click",function(){const e=$(this).attr("data-coid"),o=$("#"+$(this).attr("data-id"));t.find(".hok_comment__respond-form").attr("data-coid",e),o.append(t),$(".hok_comment__respond-type .item[data-type='text']").click(),$(".hok_comment__cancle").show(),window.scrollTo({top:o.offset().top-$(".hok_header").height()-15,behavior:"smooth"})}),$(".hok_comment__cancle").on("click",function(){t.find(".hok_comment__respond-form").removeAttr("data-coid"),$(".hok_comment__cancle").hide(),$(".hok_comment__title").after(t),$(".hok_comment__respond-type .item[data-type='text']").click(),window.scrollTo({top:$(".hok_comment").offset().top-$(".hok_header").height()-15,behavior:"smooth"})})}}function activeCommentSubmit(){if($(".hok_comment").length){let t=!1;$(".hok_comment__respond-form").on("submit",function(e){e.preventDefault();const o=$(".hok_comment__respond-form").attr("action")+"?time="+ +new Date,a=$(".hok_comment__respond-form").attr("data-type"),n=$(".hok_comment__respond-form").attr("data-coid"),i=$(".hok_comment__respond-form .head input[name='author']").val(),s=$(".hok_comment__respond-form input[name='_']").val(),c=$(".hok_comment__respond-form .head input[name='mail']").val(),r=$(".hok_comment__respond-form .head input[name='url']").val();let m=$(".hok_comment__respond-form .body textarea[name='text']").val();if(""===i.trim())return Qmsg.info("请输入昵称！");if(!/\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/.test(c))return Qmsg.info("请输入正确的邮箱！");if("text"===a&&""===m.trim())return Qmsg.info("请输入评论内容！");if("draw"===a){const t=$("#hok_comment_draw")[0].toDataURL("image/webp",.1);m="{!{"+t+"}!} "}t||(t=!0,$(".hok_comment__respond-form .foot .submit button").html("发送中..."),$.ajax({url:o,type:"POST",data:{author:i,mail:c,text:m,parent:n,url:r,_:s},dataType:"text",success(e){let o=[],a="";if(o=$(e).contents(),Array.from(o).forEach(t=>{"container"===t.parentNode.className&&(a=t)}),/Hok/.test(e)){let t=new DOMParser,o=t.parseFromString(e,"text/html"),a=e.match(/id=\"?comment-\d+/g).join().match(/\d+/g).sort((t,e)=>t-e).pop(),n="comment-"+a,i=document.getElementById("hok_comment"),s=o.getElementById("hok_comment");i.innerHTML=s.innerHTML,Qmsg.success("评论成功！"),document.getElementById(n).scrollIntoView({behavior:"smooth"}),initComments()}else Qmsg.warning(a.textContent.trim()||""),t=!1,$(".hok_comment__respond-form .foot .submit button").html("发表评论")},error(){t=!1,$(".hok_comment__respond-form .foot .submit button").html("发表评论"),Qmsg.warning("发送失败！请刷新重试！")}}))})}}function setCommentReplyTarget(){$(".comment-list__item .term .content .user .author a").each((t,e)=>$(e).attr("target","_blank"))}function formatCommentsPageHash(){$(".hok_comment .hok_pagination a").each((t,e)=>{const o=$(e).attr("href");o&&o.includes("#")&&$(e).attr("href",o.replace("#comments","?scroll=hok_comment"))})}function initOwo(){$(".hok_owo__contain").length&&$(".hok_owo__target").length&&$.ajax({url:window.Hok.THEME_URL+"assets/json/hok.owo.json",dataType:"json",success(t){let e="",o="";for(let a in t){const n=t[a];e+=`<div class="item" data-type="${a}">${a}</div>`,o+=`\n                            <ul class="scroll" data-type="${a}">\n\t\t\t\t\t\t\t\t${n.map(t=>`<li class="item" data-text="${t.data}">${"颜文字"===a?`${t.icon}`:`<img class="lazyload" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjUyOTQ1MjE4NjI3IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjMzNTEiIHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTU2My4yIDQ2My4zTDY3NyA1NDBjMS43IDEuMiAzLjcgMS44IDUuOCAxLjggMC43IDAgMS40LTAuMSAyLTAuMiAyLjctMC41IDUuMS0yLjEgNi42LTQuNGwyNS4zLTM3LjhjMS41LTIuMyAyLjEtNS4xIDEuNi03LjhzLTIuMS01LjEtNC40LTYuNmwtNzMuNi00OS4xIDczLjYtNDkuMWMyLjMtMS41IDMuOS0zLjkgNC40LTYuNiAwLjUtMi43IDAtNS41LTEuNi03LjhsLTI1LjMtMzcuOGExMC4xIDEwLjEgMCAwIDAtNi42LTQuNGMtMC43LTAuMS0xLjMtMC4yLTItMC4yLTIuMSAwLTQuMSAwLjYtNS44IDEuOGwtMTEzLjggNzYuNmMtOS4yIDYuMi0xNC43IDE2LjQtMTQuNyAyNy41IDAuMSAxMSA1LjUgMjEuMyAxNC43IDI3LjR6TTM4NyAzNDguOGgtNDUuNWMtNS43IDAtMTAuNCA0LjctMTAuNCAxMC40djE1My4zYzAgNS43IDQuNyAxMC40IDEwLjQgMTAuNEgzODdjNS43IDAgMTAuNC00LjcgMTAuNC0xMC40VjM1OS4yYzAtNS43LTQuNy0xMC40LTEwLjQtMTAuNHogbTMzMy44IDI0MS4zbC00MS0yMGExMC4zIDEwLjMgMCAwIDAtOC4xLTAuNWMtMi42IDAuOS00LjggMi45LTUuOSA1LjQtMzAuMSA2NC45LTkzLjEgMTA5LjEtMTY0LjQgMTE1LjItNS43IDAuNS05LjkgNS41LTkuNSAxMS4ybDMuOSA0NS41YzAuNSA1LjMgNSA5LjUgMTAuMyA5LjVoMC45Yzk0LjgtOCAxNzguNS02Ni41IDIxOC42LTE1Mi43IDIuNC01IDAuMy0xMS4yLTQuOC0xMy42eiBtMTg2LTE4Ni4xYy0xMS45LTQyLTMwLjUtODEuNC01NS4yLTExNy4xLTI0LjEtMzQuOS01My41LTY1LjYtODcuNS05MS4yLTMzLjktMjUuNi03MS41LTQ1LjUtMTExLjYtNTkuMi00MS4yLTE0LTg0LjEtMjEuMS0xMjcuOC0yMS4xaC0xLjJjLTc1LjQgMC0xNDguOCAyMS40LTIxMi41IDYxLjctNjMuNyA0MC4zLTExNC4zIDk3LjYtMTQ2LjUgMTY1LjgtMzIuMiA2OC4xLTQ0LjMgMTQzLjYtMzUuMSAyMTguNCA5LjMgNzQuOCAzOS40IDE0NSA4Ny4zIDIwMy4zIDAuMSAwLjIgMC4zIDAuMyAwLjQgMC41bDM2LjIgMzguNGMxLjEgMS4yIDIuNSAyLjEgMy45IDIuNiA3My4zIDY2LjcgMTY4LjIgMTAzLjUgMjY3LjUgMTAzLjUgNzMuMyAwIDE0NS4yLTIwLjMgMjA3LjctNTguNyAzNy4zLTIyLjkgNzAuMy01MS41IDk4LjEtODUgMjcuMS0zMi43IDQ4LjctNjkuNSA2NC4yLTEwOS4xIDE1LjUtMzkuNyAyNC40LTgxLjMgMjYuNi0xMjMuOCAyLjQtNDMuNi0yLjUtODctMTQuNS0xMjl6IG0tNjAuNSAxODEuMWMtOC4zIDM3LTIyLjggNzItNDMgMTA0LTE5LjcgMzEuMS00NC4zIDU4LjYtNzMuMSA4MS43LTI4LjggMjMuMS02MSA0MS05NS43IDUzLjQtMzUuNiAxMi43LTcyLjkgMTkuMS0xMTAuOSAxOS4xLTgyLjYgMC0xNjEuNy0zMC42LTIyMi44LTg2LjJsLTM0LjEtMzUuOGMtMjMuOS0yOS4zLTQyLjQtNjIuMi01NS4xLTk3LjctMTIuNC0zNC43LTE4LjgtNzEtMTkuMi0xMDcuOS0wLjQtMzYuOSA1LjQtNzMuMyAxNy4xLTEwOC4yIDEyLTM1LjggMzAtNjkuMiA1My40LTk5LjEgMzEuNy00MC40IDcxLjEtNzIgMTE3LjItOTQuMSA0NC41LTIxLjMgOTQtMzIuNiAxNDMuNC0zMi42IDQ5LjMgMCA5NyAxMC44IDE0MS44IDMyIDM0LjMgMTYuMyA2NS4zIDM4LjEgOTIgNjQuOCAyNi4xIDI2IDQ3LjUgNTYgNjMuNiA4OS4yIDE2LjIgMzMuMiAyNi42IDY4LjUgMzEgMTA1LjEgNC42IDM3LjUgMi43IDc1LjMtNS42IDExMi4zeiIgcC1pZD0iMzM1MiIgZmlsbD0iI2JmYmZiZiI+PC9wYXRoPjwvc3ZnPg==" data-src="${window.Hok.THEME_URL+t.icon}" alt="${t.data}"/>`}</li>`).join("")}\n                            </ul>\n                        `}$(".hok_owo__contain").html(`\n                        <div class="seat"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" style="height: 23px;line-height: 23px;opacity: .8;border-radius: 50px;width: 23px;fill: var(--routine);"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm141.4 389.4c-37.8 37.8-88 58.6-141.4 58.6s-103.6-20.8-141.4-58.6S48 309.4 48 256s20.8-103.6 58.6-141.4S194.6 56 248 56s103.6 20.8 141.4 58.6S448 202.6 448 256s-20.8 103.6-58.6 141.4zM328 224c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm-160 0c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm194.4 64H133.6c-8.2 0-14.5 7-13.5 15 7.5 59.2 58.9 105 121.1 105h13.6c62.2 0 113.6-45.8 121.1-105 1-8-5.3-15-13.5-15z"></path></svg></div>\n                        <div class="box">\n                            ${o}\n                            <div class="bar">${e}</div>\n                        </div>\n                    `),$(document).on("click",function(){$(".hok_owo__contain .box").stop().slideUp("fast")}),$(".hok_owo__contain .seat").on("click",function(t){t.stopPropagation(),$(this).siblings(".box").stop().slideToggle("fast")}),$(".hok_owo__contain .box .bar .item").on("click",function(t){t.stopPropagation(),$(this).addClass("active").siblings().removeClass("active");const e='.hok_owo__contain .box .scroll[data-type="'+$(this).attr("data-type")+'"]';$(e).show().siblings(".scroll").hide()}),$(".hok_owo__contain .scroll .item").on("click",function(){const t=$(this).attr("data-text");$(".hok_owo__target").insertContent(t)}),$(".hok_owo__contain .box .bar .item").first().click()}})}function initPost(){const t=t=>window.btoa(unescape(encodeURIComponent(t))),e=t=>decodeURIComponent(escape(window.atob(t))),o=$(".hok_detail").attr("data-cid");$.ajax({url:Hok.BASE_API,type:"POST",dataType:"json",data:{routeType:"baidu_record",site:window.location.href},success(t){if(t.data&&"已收录"===t.data);else if(Hok.BAIDU_PUSH){const t=setTimeout(function(){$.ajax({url:Hok.BASE_API,type:"POST",dataType:"json",data:{routeType:"baidu_push",domain:window.location.protocol+"//"+window.location.hostname,url:encodeURI(window.location.href)},success(t){t.data.error}}),clearTimeout(t)},1e3)}else{encodeURI(window.location.href)}}}),Prism.highlightAll(),$("pre[class*='language-']").each(function(t,e){let o=$(e).find("code[class*='language-']").text(),a=$('<span class="copy"><i class="fa fa-clone"></i></span>');new ClipboardJS(a[0],{text:()=>o}).on("success",()=>Qmsg.success("复制成功！")),$(e).append(a)}),$(".hok_detail__article a:not(.hok_detail__article-anote)").each(function(){$(this).attr({target:"_blank",rel:"noopener noreferrer nofollow"})});{let a=localStorage.getItem(t("views"))?JSON.parse(e(localStorage.getItem(t("views")))):[];const n=a.includes(o);n||$.ajax({url:Hok.BASE_API,type:"POST",dataType:"json",data:{routeType:"handle_views",cid:o},success(e){if(1!==e.code)return;$("#Hok_Article_Views").html(`${e.data.views} 阅读`),a.push(o);const n=t("views"),i=t(JSON.stringify(a));localStorage.setItem(n,i)}})}{let a=localStorage.getItem(t("agree"))?JSON.parse(e(localStorage.getItem(t("agree")))):[];a.includes(o)?$(".hok_detail__agree .icon-1").addClass("active"):$(".hok_detail__agree .icon-2").addClass("active");let n=!1;$(".hok_detail__agree .icon").on("click",function(){if(n)return;n=!0,a=localStorage.getItem(t("agree"))?JSON.parse(e(localStorage.getItem(t("agree")))):[];let i=a.includes(o);$.ajax({url:Hok.BASE_API,type:"POST",dataType:"json",data:{routeType:"handle_agree",cid:o,type:i?"disagree":"agree"},success(e){if(1!==e.code)return;if($(".hok_detail__agree .text").html(e.data.agree),i){const t=a.findIndex(t=>t===o);a.splice(t,1),$(".hok_detail__agree .icon-1").removeClass("active"),$(".hok_detail__agree .icon-2").addClass("active"),$(".hok_detail__agree .icon").removeClass("active"),Qmsg.warning("已取消点赞！")}else a.push(o),$(".hok_detail__agree .icon-2").removeClass("active"),$(".hok_detail__agree .icon-1").addClass("active"),$(".hok_detail__agree .icon").addClass("active"),Qmsg.success("点赞成功");const n=t("agree"),s=t(JSON.stringify(a));localStorage.setItem(n,s)},complete(){n=!1}})})}{let t=!1;$(".hok_detail__article-protected").on("submit",function(e){e.preventDefault();const a=$(this).attr("action")+"&time="+ +new Date,n=$(this).find('input[type="password"]').val();if(""===n.trim())return Qmsg.info("请输入访问密码！");t||(t=!0,$.ajax({url:a,type:"POST",data:{cid:o,protectCID:o,protectPassword:n},dataType:"text",success(e){let o=[],a="";o=$(e).contents(),Array.from(o).forEach(t=>{"container"===t.parentNode.className&&(a=t)}),/Hok/.test(e)?location.reload():(Qmsg.warning(a.textContent.trim()||""),t=!1,$(".hok_comment__respond-form .foot .submit button").html("发表评论"))}}))})}if($(".hok_detail__article-video").length>0){const t=$(".hok_detail__article-video .play iframe").attr("data-player");$(".hok_detail__article-video .episodes .item").on("click",function(){$(this).addClass("active").siblings().removeClass("active");const e=$(this).attr("data-src");$(".hok_detail__article-video .play iframe").attr({src:t+e})}),$(".hok_detail__article-video .episodes .item").first().click()}$(".hok_detail__operate-share").length&&($(".hok_detail__operate-share > svg").on("click",t=>{t.stopPropagation(),$(".hok_detail__operate-share").toggleClass("active")}),$(document).on("click",()=>$(".hok_detail__operate-share").removeClass("active")))}function initPostMenu(){if(0===$(".hok_detail__article").find("h2,h3,h4,h5,h6").length)$(".postmenu").remove();else{$(".postmenu").show();const t=["h2","h3","h4","h5","h6"],e=$("#post_menu");$(".hok_detail__article").find("h2,h3,h4,h5,h6").each(function(o,a){const n=$(a),i=parseInt(n[0].tagName.charAt(1),10)-2,s=$("<li></li>").append('<span class="post_menu_item post_menu_tag_'+t[i]+'" goto="#menu'+o+'">'+n.text()+"</span>");if(0===i)e.append(s);else{const t=e.find("li").last().children("ol, ul");0===t.length&&e.find("li").last().append("<ol></ol>"),e.find("li").last().children("ol, ul").append(s)}$('<span id="menu'+o+'"></span>').insertBefore(n)}),$("#post_menu span").each(function(){const t=$(this),e=parseInt(t.attr("class").slice(-1),10),o=1*(e-2)+.5+"rem";t.css("padding-left",o)}),$(window).on("scroll",function(){highlightCurrentHeading()})}}function highlightCurrentHeading(){const t=$(".hok_header").offset().top+$(".hok_header").outerHeight();let e=!1;$(".hok_detail__article").find("h2,h3,h4,h5,h6").each(function(o,a){const n=$(a),i=n.offset().top;i<=t+5&&($(".post_menu_item").removeClass("active"),$(".post_menu_item:eq("+o+")").addClass("active"),e=!0)}),e||$(".post_menu_item").removeClass("active")}document.addEventListener("DOMContentLoaded",()=>{initComments(),initPostPage()}),$(document).on("click","#post_menu .post_menu_item",function(){$(".menu_position").after($("#post_menu"));const t=$(this).attr("goto");0===$(".hok_header").height()?window.scrollTo({top:$(t).offset().top,behavior:"smooth"}):window.scrollTo({top:$(t).offset().top-($(".hok_header").offset().top-$(window).scrollTop()+$(".hok_header").outerHeight()),behavior:"smooth"})});